#!/usr/bin/env python

import sys
import os
import traceback

from importlib import import_module
import argparse

try:
    CARP_DIR = str(os.environ['CARP_DIR'])
except Exception as e:
    print("Couldn't source CARP directory")
    print(e)    

# create CARP_DIR path
sys.path.append(os.path.expanduser(CARP_DIR))

'''
argument list:
1 - config file for digitiser settings (usually you wont change this much)
2 - config file for recording settings (trigger settings, window size, etc.)
'''
parser = argparse.ArgumentParser(description='Executable for running CARP', usage='''
======================================
CAEN Acquisition and Readout Program (CARP)
Use 'carp --help' for more information
======================================''', formatter_class=argparse.RawTextHelpFormatter)

parser.add_argument("dig_config", help = 'digitiser config file.')
parser.add_argument("rec_config", help = 'recording config file.')
# acquire arguments

args = parser.parse_args()


def run_CARP(dig_config, rec_config):
    '''
    Run CARP with the given digitiser and recording config files.
    Currently only for testing.
    Args:
        dig_config (str): Path to the digitiser config file.
        rec_config (str): Path to the recording config file.
    '''

    from core import controller
    controller = controller.Controller()
    sys.exit(controller.run_app())


try:
    run_CARP(args.dig_config, args.rec_config)
except Exception as e:
    print(e)
    traceback.print_exc()
    exit(1)
